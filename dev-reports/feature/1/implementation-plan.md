# Issue #1 å®Ÿè£…è¨ˆç”»æ›¸
# myCodeBranchDesk åˆç‰ˆé–‹ç™º

**ä½œæˆæ—¥**: 2025-11-17
**å¯¾è±¡Issue**: #1 - åˆç‰ˆ
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨ˆç”»ä¸­

---

## ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ç¾çŠ¶åˆ†æ](#ç¾çŠ¶åˆ†æ)
3. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
4. [å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º](#å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º)
5. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ)
6. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
7. [APIä»•æ§˜](#apiä»•æ§˜)
8. [è©³ç´°ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ](#è©³ç´°ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ)
9. [ãƒªã‚¹ã‚¯ã¨å¯¾ç­–](#ãƒªã‚¹ã‚¯ã¨å¯¾ç­–)
10. [å®Œäº†æ¡ä»¶](#å®Œäº†æ¡ä»¶)

---

## æ¦‚è¦

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„

git worktree ã”ã¨ã« Claude Code / tmux ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼µã‚Šã€ã‚¹ãƒãƒ›ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã€Œãƒ–ãƒ©ãƒ³ãƒã”ã¨ã®ãƒãƒ£ãƒƒãƒˆ UIã€ã¨ã—ã¦æ“ä½œã§ãã‚‹é–‹ç™ºã‚³ãƒ³ãƒ‘ãƒ‹ã‚ªãƒ³ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### ä¸»è¦æ©Ÿèƒ½

1. **ç”»é¢A: Worktreeä¸€è¦§** - git worktree ã‚’æœ€çµ‚æ›´æ–°æ—¥æ™‚é †ã«ä¸€è¦§è¡¨ç¤º
2. **ç”»é¢B: ãƒãƒ£ãƒƒãƒˆç”»é¢** - worktreeå°‚ç”¨ã®Claudeå¯¾è©±ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
3. **ç”»é¢C: ãƒ­ã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢** - Markdownãƒ­ã‚°ã®è©³ç´°è¡¨ç¤º
4. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡** - WebSocketã«ã‚ˆã‚‹éåŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡
5. **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** - Stopãƒ•ãƒƒã‚¯ã«ã‚ˆã‚‹å‡¦ç†å®Œäº†æ¤œçŸ¥

---

## ç¾çŠ¶åˆ†æ

### æ—¢å­˜ãƒªã‚½ãƒ¼ã‚¹

âœ… **å­˜åœ¨ã™ã‚‹ã‚‚ã®**:
- `README.md` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `docs/swe-agents.md` - SWEã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘ã‘ã‚¬ã‚¤ãƒ‰
- `docs/architecture.md` - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸ï¼ˆäºˆå®šï¼‰
- `dev-reports/` - é–‹ç™ºãƒ¬ãƒãƒ¼ãƒˆæ ¼ç´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

âŒ **æœªå®Ÿè£…**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–ï¼ˆNext.js, TypeScriptï¼‰
- å…¨ã¦ã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰
- package.json ãŠã‚ˆã³ä¾å­˜é–¢ä¿‚
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
- ç’°å¢ƒå¤‰æ•°è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

### ã‚®ãƒ£ãƒƒãƒ—åˆ†æ

ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ã¿ã§ã€å®Ÿè£…ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„ã€‚
**ã‚¼ãƒ­ã‹ã‚‰ã®å®Œå…¨å®Ÿè£…ãŒå¿…è¦**ã€‚

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----|----------|------|
| Next.js | 14.x (App Router) | UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| React | 18.x | UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| TypeScript | 5.x | å‹å®‰å…¨æ€§ |
| Tailwind CSS | 3.x | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |
| react-markdown | 9.x | Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----|----------|------|
| Node.js | 20.x | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  |
| Next.js API Routes | - | RESTful API |
| WebSocket (ws) | 8.x | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ |
| better-sqlite3 | 9.x | SQLiteã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ãƒ„ãƒ¼ãƒ«

| æŠ€è¡“ | ç”¨é€” |
|-----|------|
| tmux | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† |
| Claude CLI | LLMçµ±åˆ |
| git worktree | ãƒ–ãƒ©ãƒ³ãƒç®¡ç† |

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ§‹ç¯‰ ğŸ—ï¸

**ç›®æ¨™**: é–‹ç™ºç’°å¢ƒã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®ç¢ºç«‹

- [ ] Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
- [ ] TypeScriptè¨­å®š
- [ ] ESLint / Prettierè¨­å®š
- [ ] Tailwind CSSè¨­å®š
- [ ] åŸºæœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
- [ ] ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆ.env.exampleä½œæˆï¼‰
- [ ] Git ignoreè¨­å®š

**æˆæœç‰©**:
- å‹•ä½œã™ã‚‹Next.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç©ºã®ãƒšãƒ¼ã‚¸ï¼‰
- åŸºæœ¬çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

---

### Phase 2: ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼å®Ÿè£… ğŸ’¾

**ç›®æ¨™**: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ§‹ç¯‰

- [ ] SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ
- [ ] `src/lib/db.ts` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- [ ] `src/types/models.ts` - å‹å®šç¾©
  - Worktreeå‹
  - ChatMessageå‹
  - WorktreeSessionStateå‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ï¼ˆåŸºæœ¬ç‰ˆï¼‰

**æˆæœç‰©**:
- `db.sqlite` ãƒ•ã‚¡ã‚¤ãƒ«
- å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- CRUDæ“ä½œé–¢æ•°

**æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“

---

### Phase 3: Worktreeç®¡ç†æ©Ÿèƒ½ ğŸŒ³

**ç›®æ¨™**: git worktreeã®ã‚¹ã‚­ãƒ£ãƒ³ã¨ç®¡ç†

- [ ] `src/lib/worktrees.ts` - worktreeæ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
  - `git worktree list` ãƒ‘ãƒ¼ã‚µãƒ¼
  - worktreeãƒ‘ã‚¹ã®æ­£è¦åŒ–
  - URLã‚»ãƒ¼ãƒ•ãªIDç”Ÿæˆ
- [ ] worktreeã‚¹ã‚­ãƒ£ãƒ³ã®ãƒ†ã‚¹ãƒˆ
- [ ] DBã¸ã®worktreeæƒ…å ±ä¿å­˜

**æˆæœç‰©**:
- worktreeè‡ªå‹•æ¤œå‡ºæ©Ÿèƒ½
- worktreeä¸€è¦§å–å¾—é–¢æ•°

**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

---

### Phase 4: tmuxçµ±åˆ ğŸ–¥ï¸

**ç›®æ¨™**: tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…

- [ ] `src/lib/tmux.ts` - tmuxãƒ©ãƒƒãƒ‘ãƒ¼
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ãƒã‚§ãƒƒã‚¯ (`has-session`)
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ (`new-session`)
  - ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ (`send-keys`)
  - å‡ºåŠ›å–å¾— (`capture-pane`)
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº† (`kill-session`)
- [ ] Stopãƒ•ãƒƒã‚¯è¨­å®šãƒ­ã‚¸ãƒƒã‚¯
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**æˆæœç‰©**:
- tmuxæ“ä½œé–¢æ•°ç¾¤
- ã‚»ãƒƒã‚·ãƒ§ãƒ³é…å»¶èµ·å‹•æ©Ÿèƒ½

**æ‰€è¦æ™‚é–“**: 4-5æ™‚é–“

---

### Phase 5: API Routeså®Ÿè£… ğŸ”Œ

**ç›®æ¨™**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã®æ§‹ç¯‰

#### 5.1 Worktreeé–¢é€£API

- [ ] `GET /api/worktrees` - Worktreeä¸€è¦§å–å¾—
  - updatedAté™é †ã‚½ãƒ¼ãƒˆ
  - lastMessageSummaryå«ã‚€
- [ ] `GET /api/worktrees/:id` - Worktreeè©³ç´°å–å¾—
- [ ] `GET /api/worktrees/:id/messages` - ãƒãƒ£ãƒƒãƒˆå±¥æ­´å–å¾—
  - ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ (`before`, `limit`)

#### 5.2 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡API

- [ ] `POST /api/worktrees/:id/send` - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  - tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªãƒ»èµ·å‹•
  - send-keyså®Ÿè¡Œ
  - requestIdç”Ÿæˆãƒ»è¿”å´

#### 5.3 Stopãƒ•ãƒƒã‚¯ API

- [ ] `POST /api/hooks/claude-done` - Claudeå®Œäº†é€šçŸ¥
  - tmux capture-paneå®Ÿè¡Œ
  - å·®åˆ†æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯
  - Markdownãƒ­ã‚°ä¿å­˜
  - ChatMessage DBä¿å­˜
  - WebSocketé…ä¿¡

#### 5.4 ãƒ­ã‚°é–¢é€£API

- [ ] `GET /api/worktrees/:id/logs` - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
- [ ] `GET /api/worktrees/:id/logs/:fileName` - ãƒ­ã‚°è©³ç´°å–å¾—

**æˆæœç‰©**:
- å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹å®šç¾©
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**æ‰€è¦æ™‚é–“**: 8-10æ™‚é–“

---

### Phase 6: WebSocketå®Ÿè£… âš¡

**ç›®æ¨™**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡æ©Ÿèƒ½

- [ ] `src/lib/ws-server.ts` - WebSocketã‚µãƒ¼ãƒãƒ¼
  - room/channelç®¡ç†
  - worktreeIDåˆ¥ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ
  - æ¥ç¶šç®¡ç†
- [ ] WebSocketã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­å®š
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå†æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯

**æˆæœç‰©**:
- WebSocketã‚µãƒ¼ãƒãƒ¼
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡æ©Ÿèƒ½

**æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“

---

### Phase 7: èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ğŸ”’

**ç›®æ¨™**: ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè£…

- [ ] ç’°å¢ƒå¤‰æ•°ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  - `MCBD_ROOT_DIR`
  - `MCBD_PORT`
  - `MCBD_BIND`
  - `MCBD_AUTH_TOKEN`
- [ ] èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
  - Bearer tokenæ¤œè¨¼
  - 0.0.0.0ãƒã‚¤ãƒ³ãƒ‰æ™‚ã®å¼·åˆ¶èªè¨¼
- [ ] ãƒ‘ã‚¹æ¤œè¨¼ï¼ˆrootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ï¼‰
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š

**æˆæœç‰©**:
- èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- ã‚»ã‚­ãƒ¥ã‚¢ãªè¨­å®šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

---

### Phase 8: UIå®Ÿè£… - ç”»é¢A (Worktreeä¸€è¦§) ğŸ“±

**ç›®æ¨™**: ãƒ›ãƒ¼ãƒ ç”»é¢ã®å®Ÿè£…

- [ ] `src/app/page.tsx` - ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
  - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆã‚¹ãƒãƒ›å„ªå…ˆï¼‰
  - Worktreeä¸€è¦§è¡¨ç¤º
  - å„é …ç›®ã®æƒ…å ±è¡¨ç¤º
    - ãƒ–ãƒ©ãƒ³ãƒå
    - æœ€çµ‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„
    - ç›¸å¯¾æ™‚é–“è¡¨ç¤º
  - ã‚¿ãƒƒãƒ—ã§ãƒãƒ£ãƒƒãƒˆç”»é¢ã¸é·ç§»
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹
- [ ] ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

**æˆæœç‰©**:
- Worktreeä¸€è¦§ç”»é¢

**æ‰€è¦æ™‚é–“**: 4-5æ™‚é–“

---

### Phase 9: UIå®Ÿè£… - ç”»é¢B (ãƒãƒ£ãƒƒãƒˆ) ğŸ’¬

**ç›®æ¨™**: ãƒãƒ£ãƒƒãƒˆç”»é¢ã®å®Ÿè£…

- [ ] `src/app/worktrees/[id]/page.tsx` - ãƒãƒ£ãƒƒãƒˆç”»é¢
  - ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆworktreeåã€æˆ»ã‚‹ãƒœã‚¿ãƒ³ã€ãƒ­ã‚°ãƒœã‚¿ãƒ³ï¼‰
  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§è¡¨ç¤º
    - user/claudeåˆ¥ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
    - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¡¨ç¤º
  - ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆéå»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿è¾¼ã¿ï¼‰
  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
  - é€ä¿¡ãƒœã‚¿ãƒ³
- [ ] WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçµ±åˆ
  - æ¥ç¶šãƒ»åˆ‡æ–­å‡¦ç†
  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡å‡¦ç†
  - å†æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯
- [ ] é€ä¿¡ä¸­çŠ¶æ…‹è¡¨ç¤º
- [ ] ã‚¨ãƒ©ãƒ¼/ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¡¨ç¤º
- [ ] è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«

**æˆæœç‰©**:
- å®Œå…¨æ©Ÿèƒ½ã®ãƒãƒ£ãƒƒãƒˆç”»é¢

**æ‰€è¦æ™‚é–“**: 8-10æ™‚é–“

---

### Phase 10: UIå®Ÿè£… - ç”»é¢C (ãƒ­ã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢) ğŸ“„

**ç›®æ¨™**: ãƒ­ã‚°é–²è¦§ç”»é¢ã®å®Ÿè£…

- [ ] `src/app/worktrees/[id]/logs/page.tsx` - ãƒ­ã‚°ä¸€è¦§
  - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º
  - ä½œæˆæ—¥æ™‚è¡¨ç¤º
  - ã‚¿ãƒƒãƒ—ã§è©³ç´°ã¸é·ç§»
- [ ] `src/app/worktrees/[id]/logs/[fileName]/page.tsx` - ãƒ­ã‚°è©³ç´°
  - Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  - ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  - æˆ»ã‚‹ãƒœã‚¿ãƒ³

**æˆæœç‰©**:
- ãƒ­ã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢æ©Ÿèƒ½

**æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“

---

### Phase 11: ãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼ âœ…

**ç›®æ¨™**: å‹•ä½œæ¤œè¨¼ã¨ãƒã‚°ä¿®æ­£

- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
  - tmuxãƒ©ãƒƒãƒ‘ãƒ¼
  - worktreeæ¤œå‡º
  - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ
  - API E2Eãƒ†ã‚¹ãƒˆ
  - WebSocketãƒ†ã‚¹ãƒˆ
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆ
  - å®Ÿéš›ã®worktreeã§ã®å‹•ä½œç¢ºèª
  - ãƒãƒ«ãƒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šãƒ†ã‚¹ãƒˆ
  - ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
  - å¿œç­”æ™‚é–“è¨ˆæ¸¬
  - ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ç¢ºèª

**æˆæœç‰©**:
- ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
- ãƒã‚°ä¿®æ­£

**æ‰€è¦æ™‚é–“**: 6-8æ™‚é–“

---

### Phase 12: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ ğŸ“š

**ç›®æ¨™**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æœ€çµ‚æ›´æ–°

- [ ] `README.md` æ›´æ–°
  - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã®å®Ÿè¨¼
  - ä½¿ç”¨ä¾‹ã®è¿½åŠ 
  - ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆè¿½åŠ ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰
- [ ] `docs/architecture.md` å®Œæˆ
  - å®Ÿè£…ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åæ˜ 
  - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã®æœ€çµ‚ç‰ˆ
- [ ] `.env.example` ä½œæˆ
- [ ] CONTRIBUTING.md ä½œæˆï¼ˆä»»æ„ï¼‰
- [ ] CHANGELOG.md ä½œæˆ

**æˆæœç‰©**:
- å®Œå…¨ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
myCodeBranchDesk/
â”œâ”€â”€ .env.example                  # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ç”»é¢A: Worktreeä¸€è¦§
â”‚   â”‚   â”œâ”€â”€ globals.css           # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ worktrees/
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx      # ç”»é¢B: ãƒãƒ£ãƒƒãƒˆ
â”‚   â”‚   â”‚       â””â”€â”€ logs/
â”‚   â”‚   â”‚           â”œâ”€â”€ page.tsx              # ãƒ­ã‚°ä¸€è¦§
â”‚   â”‚   â”‚           â””â”€â”€ [fileName]/page.tsx   # ãƒ­ã‚°è©³ç´°
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ api/                  # API Routes
â”‚   â”‚       â”œâ”€â”€ worktrees/
â”‚   â”‚       â”‚   â”œâ”€â”€ route.ts                     # GET /api/worktrees
â”‚   â”‚       â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â”‚       â”œâ”€â”€ route.ts                 # GET /api/worktrees/:id
â”‚   â”‚       â”‚       â”œâ”€â”€ send/route.ts            # POST /api/worktrees/:id/send
â”‚   â”‚       â”‚       â”œâ”€â”€ messages/route.ts        # GET /api/worktrees/:id/messages
â”‚   â”‚       â”‚       â””â”€â”€ logs/
â”‚   â”‚       â”‚           â”œâ”€â”€ route.ts             # GET /api/worktrees/:id/logs
â”‚   â”‚       â”‚           â””â”€â”€ [fileName]/route.ts  # GET /api/worktrees/:id/logs/:fileName
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ hooks/
â”‚   â”‚           â””â”€â”€ claude-done/route.ts         # POST /api/hooks/claude-done
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                      # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ db.ts                 # SQLiteæ¥ç¶šãƒ»CRUD
â”‚   â”‚   â”œâ”€â”€ tmux.ts               # tmuxãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â”œâ”€â”€ worktrees.ts          # git worktreeç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ws-server.ts          # WebSocketã‚µãƒ¼ãƒãƒ¼
â”‚   â”‚   â”œâ”€â”€ auth.ts               # èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â”œâ”€â”€ logger.ts             # ãƒ­ã‚°ç®¡ç†
â”‚   â”‚   â””â”€â”€ config.ts             # ç’°å¢ƒå¤‰æ•°ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                    # å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ models.ts             # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â””â”€â”€ api.ts                # APIå‹å®šç¾©
â”‚   â”‚
â”‚   â”œâ”€â”€ components/               # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ WorktreeList.tsx      # Worktreeä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ChatMessage.tsx       # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ–ãƒ«
â”‚   â”‚   â”œâ”€â”€ ChatInput.tsx         # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›
â”‚   â”‚   â”œâ”€â”€ MarkdownRenderer.tsx  # Markdownãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
â”‚   â”‚   â””â”€â”€ LoadingSpinner.tsx    # ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
â”‚   â”‚
â”‚   â””â”€â”€ hooks/                    # Reactãƒ•ãƒƒã‚¯
â”‚       â”œâ”€â”€ useWebSocket.ts       # WebSocketç®¡ç†
â”‚       â”œâ”€â”€ useMessages.ts        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç®¡ç†
â”‚       â””â”€â”€ useWorktrees.ts       # Worktreeç®¡ç†
â”‚
â”œâ”€â”€ docs/                         # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ swe-agents.md
â”‚   â””â”€â”€ requirements.md
â”‚
â”œâ”€â”€ dev-reports/                  # é–‹ç™ºãƒ¬ãƒãƒ¼ãƒˆ
â”‚   â””â”€â”€ feature/
â”‚       â””â”€â”€ 1/
â”‚           â””â”€â”€ implementation-plan.md
â”‚
â”œâ”€â”€ scripts/                      # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ init-db.ts                # DBåˆæœŸåŒ–
â”‚   â””â”€â”€ clean-logs.ts             # ãƒ­ã‚°ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
â”‚
â”œâ”€â”€ tests/                        # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ tmux.test.ts
â”‚   â”‚   â”œâ”€â”€ worktrees.test.ts
â”‚   â”‚   â””â”€â”€ db.test.ts
â”‚   â””â”€â”€ integration/
â”‚       â””â”€â”€ api.test.ts
â”‚
â””â”€â”€ db.sqlite                     # SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (gitignore)
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Worktreeãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE worktrees (
  id TEXT PRIMARY KEY,           -- "main", "feature-foo" (URLã‚»ãƒ¼ãƒ•)
  name TEXT NOT NULL,            -- "main", "feature/foo" (è¡¨ç¤ºå)
  path TEXT NOT NULL UNIQUE,     -- çµ¶å¯¾ãƒ‘ã‚¹
  last_message_summary TEXT,     -- æœ€çµ‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„
  updated_at INTEGER             -- UNIX timestamp (ms)
);

CREATE INDEX idx_worktrees_updated_at ON worktrees(updated_at DESC);
```

### ChatMessagesãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE chat_messages (
  id TEXT PRIMARY KEY,           -- UUID
  worktree_id TEXT NOT NULL,     -- å¤–éƒ¨ã‚­ãƒ¼
  role TEXT NOT NULL,            -- "user" | "claude"
  content TEXT NOT NULL,         -- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡
  summary TEXT,                  -- è¦ç´„ï¼ˆä»»æ„ï¼‰
  timestamp INTEGER NOT NULL,    -- UNIX timestamp (ms)
  log_file_name TEXT,            -- å¯¾å¿œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å
  request_id TEXT,               -- å°†æ¥ã®æ‹¡å¼µç”¨

  FOREIGN KEY (worktree_id) REFERENCES worktrees(id) ON DELETE CASCADE
);

CREATE INDEX idx_messages_worktree_time ON chat_messages(worktree_id, timestamp DESC);
CREATE INDEX idx_messages_request_id ON chat_messages(request_id);
```

### SessionStateãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE session_states (
  worktree_id TEXT PRIMARY KEY,  -- å¤–éƒ¨ã‚­ãƒ¼
  last_captured_line INTEGER DEFAULT 0,  -- tmuxå·®åˆ†æŠ½å‡ºç”¨

  FOREIGN KEY (worktree_id) REFERENCES worktrees(id) ON DELETE CASCADE
);
```

### TypeScriptå‹å®šç¾©

```typescript
// src/types/models.ts

export interface Worktree {
  id: string;
  name: string;
  path: string;
  lastMessageSummary?: string;
  updatedAt?: Date;
}

export type ChatRole = "user" | "claude";

export interface ChatMessage {
  id: string;
  worktreeId: string;
  role: ChatRole;
  content: string;
  summary?: string;
  timestamp: Date;
  logFileName?: string;
  requestId?: string;
}

export interface WorktreeSessionState {
  worktreeId: string;
  lastCapturedLine: number;
}
```

---

## APIä»•æ§˜

### èªè¨¼

`MCBD_BIND=0.0.0.0` ã®å ´åˆã€å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä»¥ä¸‹ã®ãƒ˜ãƒƒãƒ€ãƒ¼ãŒå¿…è¦:

```
Authorization: Bearer <MCBD_AUTH_TOKEN>
```

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

#### 1. GET `/api/worktrees`

**èª¬æ˜**: Worktreeä¸€è¦§å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "worktrees": [
    {
      "id": "feature-foo",
      "name": "feature/foo",
      "path": "/path/to/root/feature/foo",
      "lastMessageSummary": "ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ",
      "updatedAt": "2025-11-17T12:34:56.789Z"
    }
  ]
}
```

---

#### 2. GET `/api/worktrees/:id`

**èª¬æ˜**: Worktreeè©³ç´°å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "worktree": {
    "id": "feature-foo",
    "name": "feature/foo",
    "path": "/path/to/root/feature/foo",
    "lastMessageSummary": "ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ",
    "updatedAt": "2025-11-17T12:34:56.789Z"
  }
}
```

---

#### 3. GET `/api/worktrees/:id/messages`

**èª¬æ˜**: ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `before`: timestampï¼ˆã“ã®æ™‚åˆ»ã‚ˆã‚Šå‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ï¼‰
- `limit`: å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "messages": [
    {
      "id": "msg-uuid-1",
      "worktreeId": "feature-foo",
      "role": "user",
      "content": "ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„",
      "timestamp": "2025-11-17T12:34:00.000Z",
      "requestId": "req-uuid-1"
    },
    {
      "id": "msg-uuid-2",
      "worktreeId": "feature-foo",
      "role": "claude",
      "content": "ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚\n\n...",
      "timestamp": "2025-11-17T12:34:30.000Z",
      "logFileName": "20251117-123430-feature-foo-abc123.md",
      "requestId": "req-uuid-1"
    }
  ],
  "hasMore": false
}
```

---

#### 4. POST `/api/worktrees/:id/send`

**èª¬æ˜**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "message": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŒ‡ç¤ºãƒ†ã‚­ã‚¹ãƒˆ"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "requestId": "req-uuid-123",
  "message": {
    "id": "msg-uuid-456",
    "worktreeId": "feature-foo",
    "role": "user",
    "content": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŒ‡ç¤ºãƒ†ã‚­ã‚¹ãƒˆ",
    "timestamp": "2025-11-17T12:40:00.000Z",
    "requestId": "req-uuid-123"
  }
}
```

---

#### 5. POST `/api/hooks/claude-done`

**èª¬æ˜**: Claudeå®Œäº†ãƒ•ãƒƒã‚¯ï¼ˆå†…éƒ¨APIï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "worktreeId": "feature-foo",
  "requestId": "req-uuid-123"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": {
    "id": "msg-uuid-789",
    "worktreeId": "feature-foo",
    "role": "claude",
    "content": "...",
    "timestamp": "2025-11-17T12:40:30.000Z",
    "logFileName": "20251117-124030-feature-foo-xyz789.md",
    "requestId": "req-uuid-123"
  }
}
```

---

#### 6. GET `/api/worktrees/:id/logs`

**èª¬æ˜**: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "logs": [
    {
      "fileName": "20251117-124030-feature-foo-xyz789.md",
      "createdAt": "2025-11-17T12:40:30.000Z",
      "size": 12345
    }
  ]
}
```

---

#### 7. GET `/api/worktrees/:id/logs/:fileName`

**èª¬æ˜**: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "fileName": "20251117-124030-feature-foo-xyz789.md",
  "content": "## User\n\n...\n\n## Claude\n\n...",
  "createdAt": "2025-11-17T12:40:30.000Z"
}
```

---

### WebSocketãƒ—ãƒ­ãƒˆã‚³ãƒ«

**æ¥ç¶š**: `ws://localhost:3000/ws`

**ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```json
{
  "type": "subscribe",
  "worktreeId": "feature-foo"
}
```

**å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
```json
{
  "type": "chat_message_created",
  "worktreeId": "feature-foo",
  "message": {
    "id": "msg-uuid",
    "role": "claude",
    "content": "...",
    "timestamp": "2025-11-17T12:40:30.000Z",
    "logFileName": "..."
  }
}
```

---

## è©³ç´°ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ§‹ç¯‰

- [ ] 1.1 Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
  ```bash
  npx create-next-app@latest myCodeBranchDesk --typescript --tailwind --app --src-dir
  ```
- [ ] 1.2 ä¾å­˜é–¢ä¿‚è¿½åŠ 
  - better-sqlite3
  - ws
  - @types/ws
  - react-markdown
  - remark-gfm
  - uuid
  - @types/uuid
- [ ] 1.3 tsconfig.json èª¿æ•´
- [ ] 1.4 .eslintrc.json è¨­å®š
- [ ] 1.5 .prettierrc è¨­å®š
- [ ] 1.6 .gitignore æ›´æ–°
  - db.sqlite
  - .env.local
  - .claude_logs/
- [ ] 1.7 .env.example ä½œæˆ

### Phase 2: ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼å®Ÿè£…

- [ ] 2.1 `src/types/models.ts` ä½œæˆ
- [ ] 2.2 `src/lib/db.ts` ä½œæˆ
  - initDatabase()
  - getWorktrees()
  - getWorktreeById()
  - upsertWorktree()
  - getMessages()
  - createMessage()
  - getSessionState()
  - updateSessionState()
- [ ] 2.3 `scripts/init-db.ts` ä½œæˆ
- [ ] 2.4 DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

### Phase 3: Worktreeç®¡ç†æ©Ÿèƒ½

- [ ] 3.1 `src/lib/worktrees.ts` ä½œæˆ
  - scanWorktrees() - git worktree list å®Ÿè¡Œ
  - parseWorktreeOutput() - å‡ºåŠ›ãƒ‘ãƒ¼ã‚¹
  - generateWorktreeId() - URLã‚»ãƒ¼ãƒ•IDç”Ÿæˆ
  - syncWorktreesToDB() - DBåŒæœŸ
- [ ] 3.2 ãƒ†ã‚¹ãƒˆä½œæˆ
- [ ] 3.3 å‹•ä½œç¢ºèª

### Phase 4: tmuxçµ±åˆ

- [ ] 4.1 `src/lib/tmux.ts` ä½œæˆ
  - hasSession(sessionName)
  - createSession(sessionName, path, worktreeId)
  - sendKeys(sessionName, text)
  - capturePane(sessionName, startLine?)
  - killSession(sessionName)
- [ ] 4.2 Stopãƒ•ãƒƒã‚¯è¨­å®šãƒ­ã‚¸ãƒƒã‚¯
- [ ] 4.3 å·®åˆ†æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯
- [ ] 4.4 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] 4.5 ãƒ†ã‚¹ãƒˆä½œæˆ

### Phase 5: API Routeså®Ÿè£…

- [ ] 5.1 `src/lib/config.ts` - ç’°å¢ƒå¤‰æ•°ç®¡ç†
- [ ] 5.2 `src/lib/auth.ts` - èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- [ ] 5.3 `src/types/api.ts` - APIå‹å®šç¾©
- [ ] 5.4 `GET /api/worktrees/route.ts`
- [ ] 5.5 `GET /api/worktrees/[id]/route.ts`
- [ ] 5.6 `GET /api/worktrees/[id]/messages/route.ts`
- [ ] 5.7 `POST /api/worktrees/[id]/send/route.ts`
- [ ] 5.8 `POST /api/hooks/claude-done/route.ts`
- [ ] 5.9 `GET /api/worktrees/[id]/logs/route.ts`
- [ ] 5.10 `GET /api/worktrees/[id]/logs/[fileName]/route.ts`
- [ ] 5.11 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€
- [ ] 5.12 APIãƒ†ã‚¹ãƒˆä½œæˆ

### Phase 6: WebSocketå®Ÿè£…

- [ ] 6.1 `src/lib/ws-server.ts` ä½œæˆ
  - WebSocketã‚µãƒ¼ãƒãƒ¼åˆæœŸåŒ–
  - roomç®¡ç†
  - subscribe/unsubscribe
  - broadcast(worktreeId, message)
- [ ] 6.2 WebSocketã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­å®š
- [ ] 6.3 æ¥ç¶šç®¡ç†ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] 6.4 ãƒ†ã‚¹ãƒˆä½œæˆ

### Phase 7: èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- [ ] 7.1 ç’°å¢ƒå¤‰æ•°æ¤œè¨¼
- [ ] 7.2 èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…
- [ ] 7.3 CORSè¨­å®š
- [ ] 7.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
- [ ] 7.5 ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«å¯¾ç­–
- [ ] 7.6 èªè¨¼ãƒ†ã‚¹ãƒˆ

### Phase 8: UIå®Ÿè£… - ç”»é¢A

- [ ] 8.1 `src/hooks/useWorktrees.ts` ä½œæˆ
- [ ] 8.2 `src/components/WorktreeList.tsx` ä½œæˆ
- [ ] 8.3 `src/app/page.tsx` å®Ÿè£…
- [ ] 8.4 ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³èª¿æ•´
- [ ] 8.5 ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹
- [ ] 8.6 ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### Phase 9: UIå®Ÿè£… - ç”»é¢B

- [ ] 9.1 `src/hooks/useWebSocket.ts` ä½œæˆ
- [ ] 9.2 `src/hooks/useMessages.ts` ä½œæˆ
- [ ] 9.3 `src/components/ChatMessage.tsx` ä½œæˆ
- [ ] 9.4 `src/components/ChatInput.tsx` ä½œæˆ
- [ ] 9.5 `src/app/worktrees/[id]/page.tsx` å®Ÿè£…
- [ ] 9.6 ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…
- [ ] 9.7 è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
- [ ] 9.8 é€ä¿¡ä¸­çŠ¶æ…‹è¡¨ç¤º
- [ ] 9.9 ã‚¨ãƒ©ãƒ¼/ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¡¨ç¤º
- [ ] 9.10 ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

### Phase 10: UIå®Ÿè£… - ç”»é¢C

- [ ] 10.1 `src/components/MarkdownRenderer.tsx` ä½œæˆ
- [ ] 10.2 `src/app/worktrees/[id]/logs/page.tsx` å®Ÿè£…
- [ ] 10.3 `src/app/worktrees/[id]/logs/[fileName]/page.tsx` å®Ÿè£…
- [ ] 10.4 ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆè¨­å®š
- [ ] 10.5 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

### Phase 11: ãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼

- [ ] 11.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
  - `tests/unit/tmux.test.ts`
  - `tests/unit/worktrees.test.ts`
  - `tests/unit/db.test.ts`
- [ ] 11.2 çµ±åˆãƒ†ã‚¹ãƒˆä½œæˆ
  - `tests/integration/api.test.ts`
- [ ] 11.3 E2Eãƒ†ã‚¹ãƒˆï¼ˆä»»æ„ï¼‰
- [ ] 11.4 æ‰‹å‹•ãƒ†ã‚¹ãƒˆå®Ÿæ–½
- [ ] 11.5 ãƒã‚°ä¿®æ­£
- [ ] 11.6 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

### Phase 12: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

- [ ] 12.1 README.md æœ€çµ‚æ›´æ–°
- [ ] 12.2 docs/architecture.md å®Œæˆ
- [ ] 12.3 .env.example å®Œæˆ
- [ ] 12.4 CONTRIBUTING.md ä½œæˆ
- [ ] 12.5 CHANGELOG.md ä½œæˆ

---

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### ãƒªã‚¹ã‚¯1: tmuxçµ±åˆã®è¤‡é›‘æ€§

**ãƒªã‚¹ã‚¯**: tmuxã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›è§£æã‚„ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãŒäºˆæƒ³ä»¥ä¸Šã«è¤‡é›‘

**å¯¾ç­–**:
- Phase 4ã§ååˆ†ãªãƒ†ã‚¹ãƒˆæ™‚é–“ã‚’ç¢ºä¿
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ä¸å¯§ã«å®Ÿè£…
- tmuxä»£æ›¿æ¡ˆï¼ˆscreenç­‰ï¼‰ã‚‚æ¤œè¨å¯èƒ½ã«ã—ã¦ãŠã

---

### ãƒªã‚¹ã‚¯2: WebSocketã®å®‰å®šæ€§

**ãƒªã‚¹ã‚¯**: WebSocketæ¥ç¶šãŒä¸å®‰å®šã€å†æ¥ç¶šå‡¦ç†ãŒè¤‡é›‘

**å¯¾ç­–**:
- å†æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«å®Ÿè£…
- ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ã‚’æ¤œè¨
- æ¥ç¶šçŠ¶æ…‹ã®å¯è¦–åŒ–

---

### ãƒªã‚¹ã‚¯3: Stopãƒ•ãƒƒã‚¯ã®ä¿¡é ¼æ€§

**ãƒªã‚¹ã‚¯**: Claude CLIã®Stopãƒ•ãƒƒã‚¯ãŒæœŸå¾…é€šã‚Šå‹•ä½œã—ãªã„

**å¯¾ç­–**:
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ©Ÿæ§‹ã‚’å®Ÿè£…
- ãƒãƒ¼ãƒªãƒ³ã‚°ä½µç”¨ã®æ¤œè¨
- ãƒ•ãƒƒã‚¯ãŒå¤±æ•—ã—ãŸå ´åˆã®ãƒªã‚«ãƒãƒªãƒ¼å‡¦ç†

---

### ãƒªã‚¹ã‚¯4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

**ãƒªã‚¹ã‚¯**: å¤§é‡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ãƒ­ã‚°ã§UIãŒé…ããªã‚‹

**å¯¾ç­–**:
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆå®Ÿè£…
- ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®æ¤œè¨
- DBã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™

---

### ãƒªã‚¹ã‚¯5: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§

**ãƒªã‚¹ã‚¯**: èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ã€ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ç­‰ã®è„†å¼±æ€§

**å¯¾ç­–**:
- å…¨APIã§èªè¨¼ãƒã‚§ãƒƒã‚¯
- ãƒ‘ã‚¹æ¤œè¨¼ã®å¾¹åº•
- å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½

---

## å®Œäº†æ¡ä»¶

### æ©Ÿèƒ½å®Œäº†æ¡ä»¶

âœ… **å¿…é ˆæ©Ÿèƒ½**:

1. [ ] ç”»é¢A: Worktreeä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
2. [ ] ç”»é¢B: ãƒãƒ£ãƒƒãƒˆé€ä¿¡ãƒ»å—ä¿¡ãŒå‹•ä½œã™ã‚‹
3. [ ] ç”»é¢C: Markdownãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
4. [ ] WebSocketãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãŒå‹•ä½œã™ã‚‹
5. [ ] tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ­£ã—ãç®¡ç†ã•ã‚Œã‚‹
6. [ ] Stopãƒ•ãƒƒã‚¯ãŒæ­£ã—ãç™ºç«ã™ã‚‹
7. [ ] ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã‚‹
8. [ ] èªè¨¼æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ï¼ˆ0.0.0.0ãƒã‚¤ãƒ³ãƒ‰æ™‚ï¼‰

---

### å“è³ªå®Œäº†æ¡ä»¶

âœ… **å“è³ªåŸºæº–**:

1. [ ] å…¨APIãŒå‹å®‰å…¨ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
2. [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
3. [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ˆã‚¹ãƒãƒ›ãƒ»PCä¸¡å¯¾å¿œï¼‰
4. [ ] ä¸»è¦æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
5. [ ] Lintãƒ»Formatã‚¨ãƒ©ãƒ¼ãŒã‚¼ãƒ­
6. [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå®Œæˆã—ã¦ã„ã‚‹

---

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å®Œäº†æ¡ä»¶

âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–**:

1. [ ] ç”»é¢Aâ†’Bã®é·ç§»ãŒ1ç§’ä»¥å†…
2. [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‹ã‚‰UIåæ˜ ã¾ã§200msä»¥å†…ï¼ˆæ¥½è¦³çš„æ›´æ–°ï¼‰
3. [ ] Stopãƒ•ãƒƒã‚¯å—ä¿¡ã‹ã‚‰ãƒ—ãƒƒã‚·ãƒ¥ã¾ã§300msä»¥å†…
4. [ ] 50ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºãŒ1ç§’ä»¥å†…

---

### ãƒªãƒªãƒ¼ã‚¹å®Œäº†æ¡ä»¶

âœ… **ãƒªãƒªãƒ¼ã‚¹æº–å‚™**:

1. [ ] README.mdã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
2. [ ] .env.exampleãŒå®Œå‚™ã•ã‚Œã¦ã„ã‚‹
3. [ ] ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒé©åˆ‡ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹
4. [ ] GitHubãƒªãƒã‚¸ãƒˆãƒªã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’ä½œæˆ
5. [ ] Issue #1ãŒã‚¯ãƒ­ãƒ¼ã‚ºå¯èƒ½ãªçŠ¶æ…‹

---

## è¦‹ç©ã‚‚ã‚Š

### ç·æ‰€è¦æ™‚é–“

| ãƒ•ã‚§ãƒ¼ã‚º | è¦‹ç©ã‚‚ã‚Šæ™‚é–“ |
|---------|------------|
| Phase 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ§‹ç¯‰ | 2-3æ™‚é–“ |
| Phase 2: ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼å®Ÿè£… | 3-4æ™‚é–“ |
| Phase 3: Worktreeç®¡ç†æ©Ÿèƒ½ | 2-3æ™‚é–“ |
| Phase 4: tmuxçµ±åˆ | 4-5æ™‚é–“ |
| Phase 5: API Routeså®Ÿè£… | 8-10æ™‚é–“ |
| Phase 6: WebSocketå®Ÿè£… | 3-4æ™‚é–“ |
| Phase 7: èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | 2-3æ™‚é–“ |
| Phase 8: UIå®Ÿè£… - ç”»é¢A | 4-5æ™‚é–“ |
| Phase 9: UIå®Ÿè£… - ç”»é¢B | 8-10æ™‚é–“ |
| Phase 10: UIå®Ÿè£… - ç”»é¢C | 3-4æ™‚é–“ |
| Phase 11: ãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼ | 6-8æ™‚é–“ |
| Phase 12: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ | 2-3æ™‚é–“ |
| **åˆè¨ˆ** | **47-62æ™‚é–“** |

**æ¨å¥¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**:
- é›†ä¸­ä½œæ¥­: 6-8æ—¥
- é€šå¸¸ä½œæ¥­: 2-3é€±é–“

---

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. **ã“ã®è¨ˆç”»æ›¸ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼** - å®Ÿè£…æ–¹é‡ã®æ‰¿èª
2. **Phase 1ã®é–‹å§‹** - Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
3. **å®šæœŸçš„ãªé€²æ—ç¢ºèª** - å„Phaseã”ã¨ã«å‹•ä½œç¢ºèª

---

**ä½œæˆè€…**: Claude (SWE Agent)
**æœ€çµ‚æ›´æ–°**: 2025-11-17
