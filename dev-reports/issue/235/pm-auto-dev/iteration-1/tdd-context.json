{
  "issue_number": 235,
  "title": "fix: プロンプト検出時にClaudeの指示メッセージが切り捨てられ表示されない",
  "acceptance_criteria": [
    "プロンプト検出時にClaudeの指示メッセージがDBに保存されること",
    "PromptMessage UIで指示テキストが表示されること",
    "既存のプロンプト検出・応答機能（Auto-Yes含む）に影響がないこと",
    "既存テストがすべてパスすること",
    "rawContent 未設定時に cleanContent へフォールバックしてDB保存されること",
    "Approveパターンのプロンプトでも rawContent が設定されること",
    "rawContent 導入前の既存DBメッセージでは content = 旧 cleanContent（質問のみ）が表示されること",
    "新規メッセージでは content = rawContent（完全出力）が表示されること",
    "既存データ・新規データの両方のケースで表示が破綻しないこと",
    "prompt-detector.test.ts に rawContent の検証テストが追加されていること",
    "response-poller.test.ts に DB 保存フォールバックロジックのテストが追加されていること",
    "PromptMessage.tsx のレンダリングテストが追加されていること"
  ],
  "implementation_tasks": [
    "PromptDetectionResult 型に rawContent?: string を追加",
    "truncateRawContent() ヘルパー関数追加（最大200行/5000文字制限）",
    "lastLines 変数を末尾10行から20行に拡張（L97）",
    "detectMultipleChoicePrompt() で rawContent: truncateRawContent(output.trim()) を返却",
    "Yes/Noパターン検出で rawContent: lastLines.trim() を返却",
    "Approveパターン検出で rawContent: lastLines.trim() を返却",
    "response-poller.ts L618 の content 値を rawContent || cleanContent に変更",
    "PromptMessage.tsx に getDisplayContent() 関数と message.content 表示を追加",
    "prompt-detector.test.ts に rawContent 検証テスト8項目を追加",
    "response-poller.test.ts に DB保存フォールバックテスト2項目を追加",
    "PromptMessage.test.tsx を新規作成しコンポーネントテスト4項目を追加"
  ],
  "target_coverage": 80,
  "design_policy_path": "dev-reports/design/issue-235-prompt-rawcontent-design-policy.md",
  "work_plan_path": "dev-reports/issue/235/work-plan.md"
}
